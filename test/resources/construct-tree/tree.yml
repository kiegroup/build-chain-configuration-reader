version: "2.1"

dependencies:
  - project: kiegroup/lienzo-core

  - project: kiegroup/kie-docs

  - project: kiegroup/lienzo-tests
    dependencies:
      - project: kiegroup/lienzo-core

  - project: kiegroup/droolsjbpm-build-bootstrap
    dependencies:
      - project: kiegroup/lienzo-core

  - project: kiegroup/kie-soup
    dependencies:
      - project: kiegroup/droolsjbpm-build-bootstrap

  - project: kiegroup/appformer
    dependencies:
      - project: kiegroup/droolsjbpm-build-bootstrap
      - project: kiegroup/lienzo-tests
      - project: kiegroup/kie-soup

  - project: kiegroup/drools
    dependencies:
      - project: kiegroup/appformer
      - project: kiegroup/kie-soup

  - project: kiegroup/jbpm
    dependencies:
      - project: kiegroup/drools
      - project: kiegroup/kie-soup

  - project: kiegroup/optaplanner
    dependencies:
      - project: kiegroup/drools
      - project: kiegroup/jbpm
    mapping:
      dependencies:
        default:
          - source: 7.x
            target: main
      dependant:
        default:
          - source: main
            target: 7.x
      exclude:
        - kiegroup/optaweb-employee-rostering
        - kiegroup/optaweb-vehicle-routing

default:
  build-command:
    current: |
      mvn clean
      mvn install
    upstream: mvn -e --builder smart -T1C clean install -DskipTests -Dgwt.compiler.skip=true -Dgwt.skipCompilation=true -Denforcer.skip=true -Dcheckstyle.skip=true -Dspotbugs.skip=true -Drevapi.skip=true
    after:
      upstream: rm -rf ./*

build:
  - project: kiegroup/appformer
    build-command:
      upstream: mvn -e clean install -DskipTests -Dgwt.compiler.skip=true -Dgwt.skipCompilation=true -Denforcer.skip=true -Dcheckstyle.skip=true -Dspotbugs.skip=true -Drevapi.skip=true
    archive-artifacts:
      path: |
        **/dashbuilder-runtime.war

  - project: kiegroup/drools
    build-command:
      upstream: mvn -e clean install -DskipTests -Dgwt.compiler.skip=true -Dgwt.skipCompilation=true -Denforcer.skip=true -Dcheckstyle.skip=true -Dspotbugs.skip=true -Drevapi.skip=true

  - project: kiegroup/optaplanner
    build-command:
      current: mvn -e clean install -nsu -Prun-code-coverage,wildfly -Dfull  -Dintegration-tests=true -Dmaven.test.failure.ignore=true
      upstream: mvn -e clean install -DskipTests -Dgwt.compiler.skip=true -Dgwt.skipCompilation=true -Denforcer.skip=true -Dcheckstyle.skip=true -Dspotbugs.skip=true -Drevapi.skip=true
    clone:
      - opta1
      - opta2
      
  - project: kiegroup/kie-docs
    build-command:
      current: mvn clean install
    clone: docs